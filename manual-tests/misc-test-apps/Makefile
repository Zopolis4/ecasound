# ----------------------------------------------------------------------
# File: ecasound/manual-tests/misc-test-apps/Makefile
# Description: Ecasound multitrack audio processing tool
# License: GPL (see ecasound/{AUTHORS,COPYING})
# ----------------------------------------------------------------------

ECAFLAGS = $(shell sh ./libecasound-config --cflags) -I.
ECALDFLAGS = $(shell sh ./libecasound-config --ldflags)
#ECALIBS = $(shell sh ./libecasound-config --libs)
ECALIBS = $(shell sh ./libecasound-config --libs_debug)

CXX=c++
CPPFLAGS += -DVERBOSE
CXXFLAGS += -Werror -O2 -g

# FIXME: move C eci tests to libecasoundc?

COMMON_SRC = 		ecatestsuite.h
GENERATED_FILES = 	ecatestlist.txt

LIB_TESTS=		eca_loop_bench$(EXEEXT)
EXEC_TESTS=		con_test1 \
			con_test2
SCRIPT_TESTS=		osc_tes1.expect

ALL_TESTS=		$(LIB_TESTS) $(EXEC_TESTS) $(SCRIPT_TESTS)

# not built:
#			eca_test1

all: $(ALL_TESTS) ecatestlist.txt

con_test1: con_test1.o
con_test2: con_test2.o
eca_loop_bench: eca_loop_bench.o
eca_loop_bench$(EXEEXT): eca_loop_bench$(EXEEXT).o

%$(EXEEXT).o: %.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(ECAFLAGS) -c -o $@ $<

%.o: %.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(ECAFLAGS) -c -o $@ $<

$(LIB_TESTS) $(EXEC_TESTS):
	$(CXX) $(LDFLAGS) $(ECALDFLAGS) -o $@ $@.o $(ECALIBS)

ecatestlist.txt: $(ALL_TESTS)
	echo "# This is an autogenerated file" > ecatestlist.txt
	echo $(ALL_TESTS) >> ecatestlist.txt

clean:
	rm -fv $(LIBS_TESTS) $(EXEC_TESTS) $(GENERATED_FILES) *.o

.PHONY: all